    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            query, 
            where 
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        // IMPORTANT: Ensure this Firebase config is correct for your project!
        const firebaseConfig = {
            apiKey: "AIzaSyDeqxzp_-kKjM3hPr6CLGfTn38e4swSKbo", // From your other files
            authDomain: "room-management-system-8e899.firebaseapp.com",
            projectId: "room-management-system-8e899",
            storageBucket: "room-management-system-8e899.appspot.com",
            messagingSenderId: "667821278853",
            appId: "1:667821278853:web:a3a80c985073772670cbec"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const instructorsCollectionRef = collection(db, "instructors");

        // --- Your existing DOM element selections ---
        const nameInput = document.getElementById('name');
        const subjectInput = document.getElementById('subject');
        const courseSelect = document.getElementById('course');
        const yearSelect = document.getElementById('year');
        const sectionSelect = document.getElementById('section');
        const daySelect = document.getElementById('day');
        const timeStartSelect = document.getElementById('timeStart');
        const timeEndSelect = document.getElementById('timeEnd');
        const errorMessageDiv = document.getElementById('errorMessage');

        // --- Your existing event listeners ---
        timeStartSelect.addEventListener('change', validateTimeRange);
        timeEndSelect.addEventListener('change', validateTimeRange);
        
        // --- Expose registerInstructor to global scope for the button ---
        window.registerInstructor = registerInstructor;


        // --- Your existing helper functions (showError, clearError, clearForm, formatTimeRange, validateTimeRange) ---
        // (These can remain largely the same, ensure they are defined within this module script or accessible)

        function validateTimeRange() {
            const startTime = timeStartSelect.value;
            const endTime = timeEndSelect.value;

            if (startTime && endTime) {
                // Convert "HH:MM" to a comparable number (e.g., 7:00 -> 7, 13:00 -> 13)
                const start = parseInt(startTime.split(':')[0], 10);
                const end = parseInt(endTime.split(':')[0], 10);

                if (end <= start) {
                    showError("End time must be later than start time");
                    timeEndSelect.value = '';
                } else {
                    clearError();
                }
            }
        }

        function showError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.style.display = 'block';
        }

        function clearError() {
            errorMessageDiv.textContent = '';
            errorMessageDiv.style.display = 'none';
        }

        function clearForm() {
            nameInput.value = '';
            subjectInput.value = '';
            courseSelect.value = '';
            yearSelect.value = '';
            sectionSelect.value = '';
            daySelect.value = '';
            timeStartSelect.value = '';
            timeEndSelect.value = '';
        }
        
        function formatTimeDisplay(timeValue) { // Renamed to avoid conflict if you have another formatTimeRange
            const hour = parseInt(timeValue.split(':')[0], 10);
            const minutes = timeValue.split(':')[1] || "00"; // Should be 00 from select
            if (hour < 12) {
                return `${hour}:${minutes} AM`;
            } else if (hour === 12) {
                return `12:${minutes} PM`;
            } else {
                return `${hour - 12}:${minutes} PM`;
            }
        }


        // --- Modified registerInstructor function for Firebase ---
        async function registerInstructor() {
            clearError(); // Clear previous errors

            const name = nameInput.value.trim();
            const subject = subjectInput.value.trim();
            const course = courseSelect.value;
            const year = yearSelect.value;
            const section = sectionSelect.value;
            const day = daySelect.value;
            const timeStart = timeStartSelect.value; // e.g., "7:00"
            const timeEnd = timeEndSelect.value;     // e.g., "8:00"

            if (!name || !subject || !course || !year || !section || !day || !timeStart || !timeEnd) {
                showError("Please fill in all required fields.");
                return;
            }
            
            // Ensure end time is after start time (already handled by validateTimeRange, but good to double check)
            const startHour = parseInt(timeStart.split(':')[0], 10);
            const endHour = parseInt(timeEnd.split(':')[0], 10);
            if (endHour <= startHour) {
                 showError("End time must be later than start time.");
                 return;
            }


            // Store time as HH:MM for easier querying range, display can be formatted.
            // For simplicity, we'll store the string values directly for now.
            // More robust: store as minutes from midnight or timestamp objects.
            const instructorData = {
                name,
                subject,
                course,
                year,
                section,
                day,
                timeStart, // "7:00"
                timeEnd,   // "8:00"
                // For display purposes, you can generate this on the fly in InstructorList.html
                // or store it:
                // timeRangeDisplay: `${formatTimeDisplay(timeStart)} - ${formatTimeDisplay(timeEnd)}` 
            };

            try {
                // --- Conflict Validation using Firestore Queries ---
                // 1. Check if instructor is teaching at any overlapping time on the same day
                const instructorTimeConflictQuery = query(instructorsCollectionRef, 
                    where("name", "==", name), 
                    where("day", "==", day)
                );
                const instructorTimeSnapshot = await getDocs(instructorTimeConflictQuery);
                for (const docSnap of instructorTimeSnapshot.docs) {
                    const existing = docSnap.data();
                    const existingStartHour = parseInt(existing.timeStart.split(':')[0], 10);
                    const existingEndHour = parseInt(existing.timeEnd.split(':')[0], 10);
                    // Check for overlap: (newStart < existingEnd) AND (newEnd > existingStart)
                    if (startHour < existingEndHour && endHour > existingStartHour) {
                        showError(`This instructor (${name}) already has a class from ${formatTimeDisplay(existing.timeStart)} to ${formatTimeDisplay(existing.timeEnd)} on ${day}.`);
                        return;
                    }
                }

                // 2. Check if this specific class already has this specific subject (case-insensitive check is harder with basic queries)
                // Firestore queries are case-sensitive. A common workaround is to store a lowercase version of the field.
                // For now, we'll do a case-sensitive check. If you need case-insensitive, we'd add e.g., `subject_lowercase`.
                const subjectInClassQuery = query(instructorsCollectionRef,
                    where("course", "==", course),
                    where("year", "==", year),
                    where("section", "==", section),
                    where("subject", "==", subject) // Case-sensitive
                );
                const subjectInClassSnapshot = await getDocs(subjectInClassQuery);
                if (!subjectInClassSnapshot.empty) {
                    showError(`The subject "${subject}" is already assigned to ${course} ${year}-${section}.`);
                    return;
                }

                // 3. Check if this specific class has any subject at overlapping times on this day
                const classTimeConflictQuery = query(instructorsCollectionRef,
                    where("course", "==", course),
                    where("year", "==", year),
                    where("section", "==", section),
                    where("day", "==", day)
                );
                const classTimeSnapshot = await getDocs(classTimeConflictQuery);
                for (const docSnap of classTimeSnapshot.docs) {
                    const existing = docSnap.data();
                     // Don't conflict with self if editing (add this logic if/when editing is implemented)
                    // if (docSnap.id === editingInstructorId) continue; 

                    const existingStartHour = parseInt(existing.timeStart.split(':')[0], 10);
                    const existingEndHour = parseInt(existing.timeEnd.split(':')[0], 10);
                    if (startHour < existingEndHour && endHour > existingStartHour) {
                        showError(`${course} ${year}-${section} already has a class ("${existing.subject}") from ${formatTimeDisplay(existing.timeStart)} to ${formatTimeDisplay(existing.timeEnd)} on ${day}.`);
                        return;
                    }
                }

                // All Firebase validations passed, add the new instructor
                await addDoc(instructorsCollectionRef, instructorData);
                alert('Instructor registered successfully with Firebase!');
                clearForm();

            } catch (error) {
                console.error("Error registering instructor: ", error);
                showError("Failed to register instructor. Check console for details. " + error.message);
            }
        }
    </script>
</body>
</html>
