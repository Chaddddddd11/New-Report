<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DHVSU Instructor List</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    /* [Previous CSS remains the same] */
    .expandable-row {
      cursor: pointer;
    }

    .expandable-row:hover {
      background-color: #e6f2f7;
    }

    .sub-table {
      background-color: #f9f9f9;
      width: 100%;
    }

    .sub-table td {
      padding: 10px;
      border-bottom: 1px solid #eee;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Registered Instructors</h1>
    </div>

    <div class="filter-section">
      <div class="filter-group">
        <input 
          type="text" 
          id="nameFilter" 
          class="filter-input" 
          placeholder="Filter by Name"
        >
        <select id="courseFilter" class="filter-input">
          <option value="">All Courses</option>
          <option value="BSA">BSA</option>
          <option value="BSAIS">BSAIS</option>
          <option value="MSMarketing">MS Marketing</option>
          <option value="BSE">BSE</option>
          <option value="BSPublicAdministration">BS Public Administration</option>
        </select>
        <select id="yearFilter" class="filter-input">
          <option value="">All Years</option>
          <option value="1st">1st Year</option>
          <option value="2nd">2nd Year</option>
          <option value="3rd">3rd Year</option>
          <option value="4th">4th Year</option>
        </select>
      </div>
    </div>

    <div class="table-container">
      <table id="instructorTable" class="instructor-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Total Enrollments</th>
            <th>Courses</th>
          </tr>
        </thead>
        <tbody id="instructorTableBody">
          <!-- Instructor data will be inserted here -->
        </tbody>
      </table>
      <div id="noInstructorsMessage" class="no-instructors"></div>
    </div>

    <div class="navigation-buttons">
      <a href="index.html" class="btn">Back to Schedule</a>
      <a href="Instructor.html" class="btn">Enroll New Instructor</a>
    </div>
  </div>

  <script>
    const tableBody = document.getElementById('instructorTableBody');
    const noInstructorsMessage = document.getElementById('noInstructorsMessage');
    const nameFilter = document.getElementById('nameFilter');
    const courseFilter = document.getElementById('courseFilter');
    const yearFilter = document.getElementById('yearFilter');

    // IMPORTANT: Clear existing instructors
    localStorage.removeItem('instructors');

    let instructors = [];

    function groupInstructorEnrollments(instructors) {
      const groupedInstructors = {};

      instructors.forEach(instructor => {
        if (!groupedInstructors[instructor.name]) {
          groupedInstructors[instructor.name] = {
            name: instructor.name,
            enrollments: [],
            courses: new Set(),
            totalEnrollments: 0
          };
        }

        groupedInstructors[instructor.name].enrollments.push(instructor);
        groupedInstructors[instructor.name].courses.add(instructor.course);
        groupedInstructors[instructor.name].totalEnrollments++;
      });

      return Object.values(groupedInstructors);
    }

    function loadInstructors() {
      instructors = JSON.parse(localStorage.getItem('instructors')) || [];
      filterAndDisplayInstructors();
    }

    function filterAndDisplayInstructors() {
      const nameFilterValue = nameFilter.value.toLowerCase();
      const courseFilterValue = courseFilter.value;
      const yearFilterValue = yearFilter.value;

      // Group instructors first
      const groupedInstructors = groupInstructorEnrollments(instructors);

      // Filter grouped instructors
      const filteredInstructors = groupedInstructors.filter(instructor => 
        (nameFilterValue === '' || instructor.name.toLowerCase().includes(nameFilterValue)) &&
        (courseFilterValue === '' || instructor.courses.has(courseFilterValue)) &&
        (yearFilterValue === '' || instructor.enrollments.some(e => e.year === yearFilterValue))
      );

      tableBody.innerHTML = '';

      if (filteredInstructors.length === 0) {
        noInstructorsMessage.textContent = 'No instructors found matching the current filters.';
        return;
      }

      noInstructorsMessage.textContent = '';

      filteredInstructors.forEach(instructor => {
        const row = document.createElement('tr');
        row.classList.add('expandable-row');
        row.innerHTML = `
          <td>${instructor.name}</td>
          <td>${instructor.totalEnrollments}</td>
          <td>${Array.from(instructor.courses).join(', ')}</td>
        `;

        // Create expandable details row
        const detailsRow = document.createElement('tr');
        const detailsCell = document.createElement('td');
        detailsCell.setAttribute('colspan', '3');
        detailsCell.classList.add('hidden');

        // Create sub-table for enrollments
        const subTable = document.createElement('table');
        subTable.classList.add('sub-table');
        const subTableBody = document.createElement('tbody');
        
        instructor.enrollments.forEach(enrollment => {
          const subRow = document.createElement('tr');
          subRow.innerHTML = `
            <td>Course: ${enrollment.course}</td>
            <td>Year: ${enrollment.year}</td>
            <td>Section: ${enrollment.section}</td>
            <td>Day: ${enrollment.day}</td>
            <td>Time: ${enrollment.time}</td>
          `;
          subTableBody.appendChild(subRow);
        });

        subTable.appendChild(subTableBody);
        detailsCell.appendChild(subTable);
        detailsRow.appendChild(detailsCell);

        // Toggle details on row click
        row.addEventListener('click', () => {
          detailsCell.classList.toggle('hidden');
        });

        tableBody.appendChild(row);
        tableBody.appendChild(detailsRow);
      });
    }

    // Add event listeners for filters
    nameFilter.addEventListener('input', filterAndDisplayInstructors);
    courseFilter.addEventListener('change', filterAndDisplayInstructors);
    yearFilter.addEventListener('change', filterAndDisplayInstructors);

    // Load instructors when page loads
    loadInstructors();
  </script>
</body>
</html>
