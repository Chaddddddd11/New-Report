<!DOCTYPE html>
<html>
<head>
  <title>DHVSU Scheduling</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1A5F7A;
      --secondary: #2C8EBB;
      --accent: #F7B32D;
      --bg: #F4F7F6;
    }

    body {
      font-family: 'Roboto', sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 15px;
      background: var(--bg);
    }

    h2 {
      background: var(--primary);
      color: white;
      text-align: center;
      padding: 12px;
      border-radius: 4px;
    }

    select {
      margin: 8px 0;
      padding: 8px;
      width: 200px;
      border: 1px solid var(--secondary);
      border-radius: 4px;
      transition: border-color 0.2s;
    }

    select:focus {
      border-color: var(--accent);
      outline: none;
    }

    .disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    #selectionSummary {
      margin: 10px 0;
      padding: 8px;
      border: 1px solid var(--secondary);
      background: #f9f9f9;
      border-radius: 4px;
      display: flex;
      gap: 10px;
    }

    #scheduleTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    #scheduleTable th, #scheduleTable td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: center;
    }

    #scheduleTable th {
      background: var(--primary);
      color: white;
    }

    .nav-buttons {
      margin-top: 15px;
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .nav-buttons button {
      padding: 8px 12px;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .nav-buttons button:hover {
      background: var(--accent);
    }

    label {
      margin-top: 8px;
      color: var(--primary);
      font-weight: 500;
    }

    .occupied-cell {
      background: var(--secondary);
      color: white;
    }

    .schedule-info {
      font-size: 11px;
    }

    .schedule-info .instructor { font-weight: bold; }
    .schedule-info .subject { font-style: italic; }
    .schedule-info .room { color: #f0f0f0; }
  </style>
</head>
<body>
  <h2>DHVSU Scheduling</h2>
  
  <label for="course">Course:</label>
  <select id="course">
    <option value="">-- Course --</option>
    <option value="BSA">BSA</option>
    <option value="BSAIS">BSAIS</option>
    <option value="MSMarketing">MS Marketing</option>
    <option value="BSE">BSE</option>
    <option value="BSPublicAdministration">BS Public Administration</option>
  </select>

  <label for="year">Year:</label>
  <select id="year" disabled>
    <option value="">-- Year --</option>
  </select>

  <label for="section">Section:</label>
  <select id="section" disabled>
    <option value="">-- Section --</option>
  </select>

  <div id="selectionSummary">
    <span id="courseSummary">----</span>
    <span>Capacity:</span>
    <span id="studentCapacityDisplay">---</span>
    <span>Students</span>
  </div>

  <h3>Schedule</h3>
  <table id="scheduleTable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Mon</th>
        <th>Tue</th>
        <th>Wed</th>
        <th>Thu</th>
        <th>Fri</th>
        <th>Sat</th>
      </tr>
    </thead>
    <tbody id="scheduleBody"></tbody>
  </table>

  <div class="nav-buttons">
    <button onclick="navigateTo('Instructor.html')">Instructors</button>
    <button onclick="navigateTo('Room.html')">Rooms</button>
  </div>

  <script>
    const studentCapacityMap = {
      'BSA-1A': 30, 'BSA-1B': 37, 'BSA-1C': 32, 'BSA-1D': 34,
      'BSA-1E': 43, 'BSA-1F': 49, 'BSA-1G': 45, 'BSA-1H': 41,
      'BSA-1I': 38, 'BSA-1J': 46, 'BSA-2A': 38, 'BSA-2B': 44,
      'BSA-2C': 46, 'BSA-2D': 34, 'BSA-2E': 39, 'BSA-2F': 35,
      'BSA-2G': 47, 'BSA-2H': 31, 'BSA-3A': 44, 'BSA-3B': 50,
      'BSA-3C': 41, 'BSA-3D': 32, 'BSA-3E': 50, 'BSA-3F': 36,
      'BSA-3G': 42, 'BSA-3H': 39, 'BSA-4A': 41, 'BSA-4B': 38,
      'BSA-4C': 35, 'BSA-4D': 47
    };

    const courseConfig = {
      BSA: {
        years: ['1st', '2nd', '3rd', '4th'],
        sections: {
          '1st': ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'],
          '2nd': ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'],
          '3rd': ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'],
          '4th': ['A', 'B', 'C', 'D']
        }
      }
    };

    const els = {
      course: document.getElementById('course'),
      year: document.getElementById('year'),
      section: document.getElementById('section'),
      courseSummary: document.getElementById('courseSummary'),
      capacity: document.getElementById('studentCapacityDisplay'),
      schedule: document.getElementById('scheduleBody')
    };

    function navigateTo(page) {
      try {
        window.location.href = page;
      } catch (e) {
        console.error('Navigation error:', e);
        alert('Navigation failed.');
      }
    }

    function getTimeSlots() {
      return [
        '7:00-8:00', '8:00-9:00', '9:00-10:00', '10:00-11:00',
        '11:00-12:00', '12:00-13:00', '13:00-14:00', '14:00-15:00',
        '15:00-16:00', '16:00-17:00', '17:00-18:00', '18:00-19:00'
      ];
    }

    function updateSchedule() {
      const { course, year, section, schedule } = els;
      schedule.innerHTML = '';
      const timeSlots = getTimeSlots();
      const instructors = JSON.parse(localStorage.getItem('instructors')) || [];
      const rooms = JSON.parse(localStorage.getItem('rooms')) || [];

      timeSlots.forEach(slot => {
        const row = document.createElement('tr');
        const [start] = slot.split('-');
        row.innerHTML = `<td>${slot}</td>`;

        ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'].forEach(day => {
          const cell = document.createElement('td');
          if (course.value && year.value && section.value) {
            const match = instructors.find(i =>
              i.course === course.value &&
              i.year === year.value &&
              i.section === section.value &&
              i.day === day &&
              parseInt(start) >= parseInt(i.time.split(' - ')[0]) &&
              parseInt(start) < parseInt(i.time.split(' - ')[1])
            );

            if (match) {
              const room = rooms.find(r => r.day === day && r.time === slot)?.room || 'TBA';
              cell.className = 'occupied-cell';
              cell.innerHTML = `
                <div class="schedule-info">
                  <div class="instructor">${match.name}</div>
                  <div class="subject">${match.subject}</div>
                  <div class="room">${room}</div>
                </div>
              `;
            }
          }
          row.appendChild(cell);
        });

        schedule.appendChild(row);
      });
    }

    function updateSummary() {
      const { course, year, section, courseSummary, capacity } = els;
      if (course.value && year.value && section.value) {
        const yearNum = { '1st': '1', '2nd': '2', '3rd': '3', '4th': '4' }[year.value];
        const key = `${course.value}-${yearNum}${section.value}`;
        courseSummary.textContent = key;
        capacity.textContent = studentCapacityMap[key] || '---';
      } else {
        courseSummary.textContent = capacity.textContent = '----';
      }
      updateSchedule();
    }

    els.course.addEventListener('change', () => {
      els.year.innerHTML = '<option value="">-- Year --</option>';
      els.section.innerHTML = '<option value="">-- Section --</option>';
      els.year.disabled = !els.course.value;
      els.section.disabled = true;

      if (els.course.value) {
        courseConfig[els.course.value].years.forEach(y => {
          const opt = document.createElement('option');
          opt.value = opt.textContent = y;
          els.year.appendChild(opt);
        });
      }
      updateSummary();
    });

    els.year.addEventListener('change', () => {
      els.section.innerHTML = '<option value="">-- Section --</option>';
      els.section.disabled = !(els.course.value && els.year.value);

      if (els.course.value && els.year.value) {
        courseConfig[els.course.value].sections[els.year.value].forEach(s => {
          const opt = document.createElement('option');
          opt.value = opt.textContent = s;
          els.section.appendChild(opt);
        });
      }
      updateSummary();
    });

    els.section.addEventListener('focus', () => {
      if (!els.year.value) {
        alert('Select a Year first');
        els.course.focus();
      }
    });

    els.section.addEventListener('change', updateSummary);
    document.addEventListener('DOMContentLoaded', updateSchedule);
  </script>
</body>
</html>
